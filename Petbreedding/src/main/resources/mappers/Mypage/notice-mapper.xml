<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="notice">
	<resultMap type="notice" id="notice">
		<id column="NOTICE_NUM" property="notNum"/>
		<result column="NOTICE_CONTENT" property="notCon"/>
		<result column="NOTICE_RECEIVER" property="notReceiver"/>
		<result column="NOTICE_PUBLISHER" property="notPublisher"/>
		<result column="REFERENCE_NUM" property="refNum"/>
		<result column="REFERENCE_CLASS" property="refClass"/>
		<result column="READ_STATE" property="readState"/>
		<result column="SHOP_NUM" property="shopNum"/>
		<result column="SHOP_NAME" property="shopName"/>
		<result column="SHOP_IMG" property="shopImg"/>
		<result column="BO_TITLE" property="boTitle"/>
		<result column="QNA_TITLE" property="qnaTitle"/>
		<result column="NOTICE_TIME" property="notTime"/>
	</resultMap>
	
	<select id="getNoticeList" resultMap="notice">
		SELECT E.*, F.QNA_TITLE
		FROM
		(SELECT C.*, D.BO_TITLE
		FROM
		(SELECT A.*, B.HOS_NUM AS SHOP_NUM, B.BP_ID, B.HOS_NAME AS SHOP_NAME, B.HOS_MIMG AS SHOP_IMG
		FROM
		(SELECT * FROM NOTICE WHERE NOTICE_RECEIVER = #{notReceiver} AND READ_STATE = 0 
		ORDER BY NOTICE_NUM DESC ) A
		LEFT OUTER JOIN 
		(SELECT * FROM HOSPITAL UNION SELECT * FROM HAIR_SALON) B
		ON A.NOTICE_PUBLISHER = B.HOS_NUM) C
		LEFT OUTER JOIN
		(SELECT * FROM BOARD) D 
		ON C.REFERENCE_NUM = D.BO_NUM)E
		LEFT OUTER JOIN
		(SELECT * FROM QNA_BOARD) F
		ON E.REFERENCE_NUM = F.QNA_NUM
	</select>
	
	<insert id="inReservaion">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a1', 
		#{notReceiver}, #{notPublisher}, #{refNum}, '1', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
	
	<insert id="inPay">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a2', 
		#{notReceiver}, #{notPublisher}, #{refNum}, '1', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
	
	<insert id="inUnreadChat">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a3', 
		#{notReceiver}, #{notPublisher}, null, '0', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
	
	<insert id="inBoard">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a4', 
		#{notReceiver}, null, #{refNum}, '2', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
	
	<insert id="inQna">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a5', 
		#{notReceiver}, null, #{refNum}, '3', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
		
	<insert id="inPointSave">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a6', 
		#{notReceiver}, null, #{refNum}, '1', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
	
	<insert id="inPointUsing">
		INSERT INTO NOTICE VALUES(SEQ_NOTICE.NEXTVAL, 'a7', 
		#{notReceiver}, null, #{refNum}, '1', 0, TO_CHAR(SYSDATE, 'YYYY-MM-DD'))
	</insert>
	
	<update id="updateReadState">
		UPDATE NOTICE SET READ_STATE = 1 WHERE NOTICE_NUM = #{notNum}
	</update>
	
	<delete id="deleteNotice">
		DELETE FROM NOTICE WHERE NOTICE_NUM = #{notNum}
	</delete>
	
</mapper>